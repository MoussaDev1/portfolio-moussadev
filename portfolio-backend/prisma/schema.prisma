generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Project {
  id               String              @id @default(cuid())
  slug             String              @unique
  title            String
  description      String
  fullDescription  String?
  type             ProjectType         @default(ZONE_SYSTEM)
  status           ProjectStatus       @default(PLANNING)
  featured         Boolean             @default(false)
  category         String?
  thumbnailUrl     String?
  demoUrl          String?
  githubUrl        String?
  caseStudyUrl     String?

// (métadonnées de projet)
  highlights       String[]
  challenges       String[]
  learnings        String[]

  duration         String?
  teamSize         Int?
  createdAt        DateTime            @default(now())
  updatedAt        DateTime            @updatedAt
  dateCompleted    DateTime?
  floors           Floor[]
  pomodoroSessions PomodoroSession[]
  posts            ProjectPost[]
  technologies     ProjectTechnology[]
  zones            Zone[]

  @@map("projects")
}

model Zone {
  id          String      @id @default(cuid())
  name        String
  description String?
  order       Int
  status      ZoneStatus  @default(TODO)
  projectId   String
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  quests      ZoneQuest[]
  project     Project     @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, order])
  @@map("zones")
}

model Floor {
  id          String       @id @default(cuid())
  name        String
  description String?
  order       Int
  status      FloorStatus  @default(TODO)
  projectId   String
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  floorQuests FloorQuest[]
  project     Project      @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, order])
  @@map("floors")
}

model ZoneQuest {
  id               String      @id @default(cuid())
  title            String
  userStory        String
  definitionOfDone String[]
  manualTests      String[]
  techDebt         String?
  status           QuestStatus @default(TODO)
  priority         Priority    @default(MEDIUM)
  estimatedHours   Int?
  actualHours      Int?
  zoneId           String
  createdAt        DateTime    @default(now())
  updatedAt        DateTime    @updatedAt
  completedAt      DateTime?
  zone             Zone        @relation(fields: [zoneId], references: [id], onDelete: Cascade)

  @@index([zoneId])
  @@index([status])
  @@index([priority])
  @@map("zone_quests")
}

model FloorQuest {
  id               String      @id @default(cuid())
  title            String
  userStory        String
  definitionOfDone String[]
  manualTests      String[]
  techDebt         String?
  status           QuestStatus @default(TODO)
  priority         Priority    @default(MEDIUM)
  estimatedHours   Int?
  actualHours      Int?
  floorId          String
  createdAt        DateTime    @default(now())
  updatedAt        DateTime    @updatedAt
  completedAt      DateTime?
  floor            Floor       @relation(fields: [floorId], references: [id], onDelete: Cascade)

  @@index([floorId])
  @@index([status])
  @@index([priority])
  @@map("floor_quests")
}

model Technology {
  id          String              @id @default(cuid())
  name        String              @unique
  slug        String              @unique
  category    TechCategory
  status      TechStatus
  description String?
  iconUrl     String?
  websiteUrl  String?
  createdAt   DateTime            @default(now())
  updatedAt   DateTime            @updatedAt
  posts       PostTechnology[]
  projects    ProjectTechnology[]

  @@map("technologies")
}

model Post {
  id           String           @id @default(cuid())
  slug         String           @unique
  title        String
  content      String
  excerpt      String?
  published    Boolean          @default(false)
  featured     Boolean          @default(false)
  thumbnailUrl String?
  readTime     Int?
  views        Int              @default(0)
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt
  publishedAt  DateTime?
  categories   PostCategory[]
  tags         PostTag[]
  technologies PostTechnology[]
  projects     ProjectPost[]

  @@map("posts")
}

model Category {
  id          String         @id @default(cuid())
  name        String         @unique
  slug        String         @unique
  description String?
  color       String?
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  posts       PostCategory[]

  @@map("categories")
}

model Tag {
  id        String    @id @default(cuid())
  name      String    @unique
  slug      String    @unique
  color     String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  posts     PostTag[]

  @@map("tags")
}

model PomodoroSession {
  id          String      @id @default(cuid())
  duration    Int
  type        SessionType
  completed   Boolean     @default(false)
  notes       String?
  projectId   String?
  createdAt   DateTime    @default(now())
  completedAt DateTime?
  project     Project?    @relation(fields: [projectId], references: [id])

  @@map("pomodoro_sessions")
}

model ProjectTechnology {
  projectId    String
  technologyId String
  createdAt    DateTime   @default(now())
  project      Project    @relation(fields: [projectId], references: [id], onDelete: Cascade)
  technology   Technology @relation(fields: [technologyId], references: [id], onDelete: Cascade)

  @@id([projectId, technologyId])
  @@map("project_technologies")
}

model ProjectPost {
  projectId String
  postId    String
  createdAt DateTime @default(now())
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@id([projectId, postId])
  @@map("project_posts")
}

model PostTechnology {
  postId       String
  technologyId String
  createdAt    DateTime   @default(now())
  post         Post       @relation(fields: [postId], references: [id], onDelete: Cascade)
  technology   Technology @relation(fields: [technologyId], references: [id], onDelete: Cascade)

  @@id([postId, technologyId])
  @@map("post_technologies")
}

model PostCategory {
  postId     String
  categoryId String
  createdAt  DateTime @default(now())
  category   Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  post       Post     @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@id([postId, categoryId])
  @@map("post_categories")
}

model PostTag {
  postId    String
  tagId     String
  createdAt DateTime @default(now())
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  tag       Tag      @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@id([postId, tagId])
  @@map("post_tags")
}

// Enums
enum ProjectType {
  ZONE_SYSTEM
  FLOOR_SYSTEM
}

enum ProjectStatus {
  PLANNING
  ACTIVE
  COMPLETED
  PAUSED
  ARCHIVED
}

enum ZoneStatus {
  TODO
  IN_PROGRESS
  COMPLETED
}

enum FloorStatus {
  TODO
  IN_PROGRESS
  COMPLETED
}

enum QuestStatus {
  TODO
  IN_PROGRESS
  TESTING
  DONE
  BLOCKED
}

enum Priority {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum TechCategory {
  LANGUAGES
  FRAMEWORKS
  LIBRARIES
  TOOLS
  PLATFORMS
  DATABASES
  DEVOPS
}

enum TechStatus {
  MASTERED
  LEARNING
  TO_REVIEW
  EXPLORING
  DEPRECATED
}

enum SessionType {
  WORK
  SHORT_BREAK
  LONG_BREAK
}
